<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Jaan ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            height: 100vh;
            width: 100vw;
            overflow-x: hidden;
            touch-action: pan-y pinch-zoom;
            background: linear-gradient(135deg, #f9a8d4, #f3e8ff);
        }

        #app {
            position: relative;
            width: 100%;
            min-height: 100vh;
            overflow-x: hidden;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Transparent Overlay Image */
        #transparent-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: none;
            opacity: 0.6; /* Increased opacity for better visibility */
            mix-blend-mode: overlay; /* Changed to overlay for better blending */
        }

        #transparent-overlay img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
        }

        #content {
            position: relative;
            z-index: 10;
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* FIXED: Reduced opacity of step containers */
        .step {
            width: 100%;
            max-width: 800px;
            margin: 40px auto;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.4); /* Reduced from 0.85 to 0.7 */
            backdrop-filter: blur(15px); /* Increased blur for better effect */
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            pointer-events: none;
            display: none;
            border: 1px solid rgba(255, 255, 255, 0.3); /* Added subtle border */
        }

        .step.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
            display: block;
        }

        .btn {
            background: linear-gradient(135deg, #ec4899, #f43f5e);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3);
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.4);
        }

        .text-gradient {
            background: linear-gradient(135deg, #ec4899, #f43f5e, #f59e0b);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Added text shadow for better readability */
        }

        .heart-beat {
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0% {
                transform: scale(1);
            }

            25% {
                transform: scale(1.1);
            }

            50% {
                transform: scale(1);
            }

            75% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        .emoji {
            font-size: 3rem;
            margin-bottom: 20px;
            display: inline-block;
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.1)); /* Added shadow to emojis */
        }

        /* FIXED: Reduced opacity of reason cards too */
        .reason-card {
            background: rgba(255, 255, 255, 0.5); /* Reduced opacity */
            border-radius: 15px;
            padding: 20px;
            margin: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .reason-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.76); /* Slightly more opaque on hover */
        }

        #progress-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 400px;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            z-index: 100;
        }

        #progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ec4899, #f43f5e);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* Image Container with Fallback */
        .image-container {
            width: 100%;
            margin: 15px 0;
            display: flex;
            justify-content: center;
            min-height: 300px;
            position: relative;
        }

        .main-image {
            max-width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            background: rgba(248, 248, 248, 0.9); /* Reduced opacity */
            padding: 10px;
            opacity: 0;
            transition: opacity 0.5s ease;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .main-image.loaded {
            opacity: 1;
        }

        .image-placeholder {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, rgba(252, 231, 243, 0.8), rgba(251, 207, 232, 0.8));
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #ec4899;
            font-size: 1.2rem;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .image-placeholder i {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin: 25px 0;
            width: 100%;
        }

        .gallery-item {
            position: relative;
            width: 100%;
            padding-top: 100%;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: rgba(248, 248, 248, 0.9); /* Reduced opacity */
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .gallery-item:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            background: rgba(248, 248, 248, 0.95);
        }

        .gallery-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 8px;
            background: transparent; /* Made background transparent */
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .gallery-img.loaded {
            opacity: 1;
        }

        /* Mobile Optimization */
        @media (max-width: 768px) {
            .step {
                padding: 30px 15px;
                margin: 20px auto;
                background: rgba(255, 255, 255, 0.40); /* Slightly more opaque on mobile for readability */
            }

            .emoji {
                font-size: 2.5rem;
            }

            .main-image {
                max-height: 300px;
            }

            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .gallery-item {
                padding-top: 100%;
            }

            #transparent-overlay {
                opacity: 0.60; /* Slightly less on mobile */
            }
        }

        @media (max-width: 480px) {
            .step {
                padding: 20px 10px;
                background: rgba(255, 255, 255, 0.4); /* More opaque on very small screens */
            }

            .main-image {
                max-height: 250px;
            }

            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
        }

        @media (max-width: 360px) {
            .gallery-grid {
                grid-template-columns: 1fr;
            }
            
            .gallery-item {
                padding-top: 120%;
            }
        }

        /* Music Player Styles */
        .music-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .music-player:hover {
            transform: scale(1.1);
            background: rgba(236, 72, 153, 0.2);
        }

        .music-player i {
            font-size: 24px;
            color: #ec4899;
        }

        /* Image Modal */
        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            cursor: pointer;
            z-index: 1001;
        }

        /* Overlay Toggle Button */
        .overlay-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .overlay-toggle:hover {
            transform: scale(1.1);
            background: rgba(59, 130, 246, 0.2);
        }

        .overlay-toggle i {
            font-size: 24px;
            color: #3b82f6;
        }

        /* Text improvements for better readability */
        .text-gray-700 {
            color: rgba(55, 65, 81, 0.95); /* Slightly darker for better contrast */
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        .text-pink-600 {
            color: rgba(219, 39, 119, 0.95);
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
        }
    </style>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div id="app">
        <div id="canvas-container"></div>

        <!-- Transparent Overlay Image -->
        <!-- REPLACE "overlay.png" WITH YOUR TRANSPARENT IMAGE FILE -->
        <div id="transparent-overlay">
            <img src="overlay.png" alt="Decorative Overlay" 
                 onload="overlayLoaded()" 
                 onerror="overlayError()">
        </div>

        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>

        <!-- Overlay Toggle Button -->
        <div class="overlay-toggle" id="overlayToggle" title="Toggle Overlay">
            <i class="fas fa-layer-group"></i>
        </div>

        <!-- Image Modal -->
        <div class="image-modal" id="imageModal">
            <span class="close-modal">&times;</span>
            <img class="modal-content" id="modalImage" src="" alt="Full size image">
        </div>

        <!-- Music Player -->
        <div class="music-player" id="musicToggle">
            <i class="fas fa-music"></i>
        </div>

        <div id="content">
            <!-- Step 1: Initial Reveal -->
            <div class="step active" id="step1">
                <div class="emoji heart-beat">‚ù§Ô∏è</div>
                <h1 class="text-4xl md:text-5xl font-bold mb-6 text-gradient">Hey Jaan ‚ù§Ô∏è</h1>
                <p class="text-xl text-gray-700 mb-8">I made something special for my beautiful jaan...</p>
                <button class="btn" id="start-btn">Let's Begin My Love</button>
            </div>

            <!-- Step 2: Birthday Message -->
            <div class="step" id="step2">
                <div class="emoji">üéâ</div>
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gradient">Happy Birthday, My Jaan! üéÇ</h2>
                <p class="text-lg text-gray-700 mb-6">
                    On your special day, I want you to know how incredibly amazing you are, jaan. 
                    Your smile brightens my entire world, your laughter is my favorite melody, 
                    and your presence makes every moment absolutely magical. You mean everything to me üíï
                </p>
                <button class="btn" id="next-btn-2">What makes you so special, jaan?</button>
            </div>

            <!-- Step 3: Reasons You're Amazing -->
            <div class="step" id="step3">
                <h2 class="text-3xl md:text-4xl font-bold mb-8 text-gradient">Here's why you're my everything, jaan</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="reason-card">
                        <div class="emoji text-3xl">‚ú®</div>
                        <h3 class="text-xl font-bold mb-2 text-pink-600">Your Beautiful Heart</h3>
                        <p class="text-gray-700">The way you care about others with so much love, jaan. You have the most beautiful heart I've ever known.</p>
                    </div>
                    <div class="reason-card">
                        <div class="emoji text-3xl">üòä</div>
                        <h3 class="text-xl font-bold mb-2 text-pink-600">Your Mesmerizing Smile</h3>
                        <p class="text-gray-700">It lights up every room you enter and stays in my heart all day, every day, jaan.</p>
                    </div>
                    <div class="reason-card">
                        <div class="emoji text-3xl">üåü</div>
                        <h3 class="text-xl font-bold mb-2 text-pink-600">Your Amazing Spirit</h3>
                        <p class="text-gray-700">Your passion and energy are absolutely contagious, jaan. You make my life so exciting!</p>
                    </div>
                </div>
                <button class="btn" id="next-btn-3">Show me our memories, jaan</button>
            </div>

            <!-- Step 4: Memory Lane -->
            <div class="step" id="step4">
                <div class="emoji">üì∏</div>
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gradient">Our Beautiful Memories, Jaan üíñ</h2>
                
                <!-- Main Memory Image with Fallback -->
                <div class="image-container" id="mainImageContainer">
                    <div class="image-placeholder" id="imagePlaceholder">
                        <i class="fas fa-heart"></i>
                        <span>Loading our special memory...</span>
                    </div>
                    <img src="Image1.jpg" alt="Our special memory" class="main-image" id="mainMemoryImage" 
                         onload="imageLoaded(this)" onerror="imageError(this)">
                </div>
                <p class="text-lg text-gray-700 italic mb-4">This moment with you is forever in my heart, jaan ‚ù§Ô∏è</p>

                <!-- Image Gallery -->
                <div class="gallery-grid" id="galleryContainer">
                    <!-- Images will be loaded dynamically -->
                </div>

                <p class="text-lg text-gray-700 mb-6 mt-4">
                    Every single moment with you becomes a cherished memory, my jaan. 
                    Whether we're laughing together or just enjoying the silence, 
                    every second with you is always so special and precious to me.
                </p>
                <button class="btn" id="next-btn-4">One Last Thing, My Love</button>
            </div>

            <!-- Step 5: Final Wish -->
            <div class="step" id="step5">
                <div class="emoji">üéÇ</div>
                <h2 class="text-3xl md:text-4xl font-bold mb-6 text-gradient">My Birthday Wish For You, Jaan</h2>
                <p class="text-lg text-gray-700 mb-8">
                    May your year be filled with endless joy, beautiful laughter, and all your dreams coming true. 
                    May you always know how incredibly special you are to me and to everyone lucky enough to know you, jaan.
                </p>
                <p class="text-xl font-semibold text-pink-600 mb-8">
                    Happy Birthday, My Beautiful Jaan! ‚ù§Ô∏è<br>
                    You are my everything üíï
                </p>
                <button class="btn" id="confetti-btn">Celebrate With Me!</button>
                <p class="mt-8 text-gray-500">Made with all my love ‚ù§Ô∏è just for you, jaan</p>
            </div>
        </div>
    </div>

    <!-- Birthday Music -->
    <audio id="birthdayMusic" loop preload="auto">
        <source src="music.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>
        // Three.js Heart Background
        const container = document.getElementById('canvas-container');
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 30;

        // Heart Geometry
        const x = 0, y = 0;
        const heartShape = new THREE.Shape();
        heartShape.moveTo(x + 0.5, y + 0.5);
        heartShape.bezierCurveTo(x + 0.5, y + 0.5, x + 1, y, x, y);
        heartShape.bezierCurveTo(x - 1, y, x - 1, y + 1.5, x - 1, y + 1.5);
        heartShape.bezierCurveTo(x - 1, y + 2.5, x + 0.5, y + 3.5, x + 0.5, y + 3.5);
        heartShape.bezierCurveTo(x + 0.5, y + 3.5, x + 2, y + 2.5, x + 2, y + 1.5);
        heartShape.bezierCurveTo(x + 2, y + 1.5, x + 2, y, x + 1, y);
        heartShape.bezierCurveTo(x + 0.5, y, x + 0.5, y + 0.5, x + 0.5, y + 0.5);

        const extrudeSettings = {
            depth: 0.5,
            bevelEnabled: true,
            bevelSegments: 3,
            bevelSize: 0.2,
            bevelThickness: 0.3
        };

        const heartGeometry = new THREE.ExtrudeGeometry(heartShape, extrudeSettings);

        // Create hearts
        const hearts = [];
        const colors = [
            0xff6b6b, 0xff8e8e, 0xffb3b3, 0xffd8d8,
            0xff9e9e, 0xffc1c1, 0xff6b8e, 0xff8eb3
        ];

        for (let i = 0; i < 25; i++) {
            const material = new THREE.MeshPhongMaterial({
                color: colors[Math.floor(Math.random() * colors.length)],
                emissive: 0xff0000,
                emissiveIntensity: 0.1,
                shininess: 100,
                transparent: true,
                opacity: 0.9
            });

            const heart = new THREE.Mesh(heartGeometry, material);

            heart.position.x = (Math.random() - 0.5) * 50;
            heart.position.y = (Math.random() - 0.5) * 50;
            heart.position.z = (Math.random() - 0.5) * 50;

            const scale = Math.random() * 0.8 + 0.5;
            heart.scale.set(scale, scale, scale);

            heart.rotation.x = Math.random() * Math.PI;
            heart.rotation.y = Math.random() * Math.PI;

            heart.userData = {
                speedX: Math.random() * 0.02 - 0.01,
                speedY: Math.random() * 0.02 - 0.01,
                speedZ: Math.random() * 0.02 - 0.01,
                rotationSpeedX: Math.random() * 0.01,
                rotationSpeedY: Math.random() * 0.01,
                originalX: heart.position.x,
                originalY: heart.position.y,
                originalZ: heart.position.z,
                floatDistance: 2 + Math.random() * 3
            };

            scene.add(heart);
            hearts.push(heart);
        }

        // Add lights
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(1, 1, 1);
        scene.add(directionalLight);

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);

            hearts.forEach(heart => {
                const time = Date.now() * 0.001;
                heart.position.x = heart.userData.originalX + Math.sin(time * heart.userData.speedX * 10) * heart.userData.floatDistance;
                heart.position.y = heart.userData.originalY + Math.sin(time * heart.userData.speedY * 10) * heart.userData.floatDistance;
                heart.position.z = heart.userData.originalZ + Math.sin(time * heart.userData.speedZ * 10) * heart.userData.floatDistance;

                heart.rotation.x += heart.userData.rotationSpeedX;
                heart.rotation.y += heart.userData.rotationSpeedY;
            });

            renderer.render(scene, camera);
        }

        animate();

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Transparent Overlay Functions
        function overlayLoaded() {
            console.log('Transparent overlay loaded successfully');
            const overlay = document.getElementById('transparent-overlay');
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.transition = 'opacity 1s ease';
                overlay.style.opacity = '0.3';
            }, 500);
        }

        function overlayError() {
            console.error('Failed to load overlay image');
            document.getElementById('transparent-overlay').style.display = 'none';
        }

        // Overlay Toggle Functionality
        const overlayToggle = document.getElementById('overlayToggle');
        const overlayContainer = document.getElementById('transparent-overlay');
        let overlayVisible = true;

        overlayToggle.addEventListener('click', function() {
            overlayVisible = !overlayVisible;
            if (overlayVisible) {
                overlayContainer.style.display = 'block';
                this.innerHTML = '<i class="fas fa-layer-group"></i>';
                this.title = 'Hide Overlay';
                overlayContainer.style.opacity = '0';
                setTimeout(() => {
                    overlayContainer.style.transition = 'opacity 0.5s ease';
                    overlayContainer.style.opacity = '0.6';
                }, 10);
            } else {
                overlayContainer.style.transition = 'opacity 0.5s ease';
                overlayContainer.style.opacity = '0';
                setTimeout(() => {
                    overlayContainer.style.display = 'none';
                }, 500);
                this.innerHTML = '<i class="fas fa-eye-slash"></i>';
                this.title = 'Show Overlay';
            }
        });

        // Image Loading Functions
        function imageLoaded(img) {
            img.classList.add('loaded');
            const placeholder = document.getElementById('imagePlaceholder');
            if (placeholder) {
                placeholder.style.display = 'none';
            }
        }

        function imageError(img) {
            console.error('Failed to load image:', img.src);
            const placeholder = document.getElementById('imagePlaceholder');
            if (placeholder) {
                placeholder.innerHTML = '<i class="fas fa-heart-broken"></i><span>Could not load image</span>';
                placeholder.style.background = 'linear-gradient(135deg, rgba(254, 215, 226, 0.8), rgba(251, 182, 206, 0.8))';
            }
        }

        // Load gallery images
        function loadGalleryImages() {
            const galleryContainer = document.getElementById('galleryContainer');
            if (!galleryContainer) return;

            const imageFiles = [
                'Image3.jpg',
                'Image4.jpg',
                'Image5.jpg',
                'Image6.jpg',
                'Image7.jpg',
                'Image8.jpg',
                'Image9.jpg',
                'Image10.jpg'
            ];

            galleryContainer.innerHTML = '';

            imageFiles.forEach((fileName, index) => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                galleryItem.dataset.image = fileName;

                const img = document.createElement('img');
                img.src = fileName;
                img.alt = `Memory ${index + 3}`;
                img.className = 'gallery-img';
                img.loading = 'lazy';
                
                img.onload = function() {
                    this.classList.add('loaded');
                };
                
                img.onerror = function() {
                    console.error('Failed to load gallery image:', this.src);
                    this.style.display = 'none';
                    galleryItem.innerHTML = '<div class="image-placeholder" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"><i class="fas fa-image"></i><span>Memory</span></div>';
                };

                galleryItem.appendChild(img);
                galleryContainer.appendChild(galleryItem);
            });

            setTimeout(() => {
                document.querySelectorAll('.gallery-img').forEach(img => {
                    img.addEventListener('click', function() {
                        openModal(this.src);
                    });
                });
            }, 100);
        }

        // Image Modal Functionality
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImage');
        const closeModal = document.querySelector('.close-modal');

        function openModal(src) {
            modal.style.display = 'flex';
            modalImg.src = src;
            if (isMusicPlaying) {
                music.pause();
                musicIcon.className = 'fas fa-music';
                isMusicPlaying = false;
                musicToggle.style.background = 'rgba(255, 255, 255, 0.9)';
            }
        }

        closeModal.addEventListener('click', function() {
            modal.style.display = 'none';
        });

        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Preload main image when step 3 is shown
        document.getElementById('next-btn-3').addEventListener('click', function() {
            loadGalleryImages();
            
            const mainImage = document.getElementById('mainMemoryImage');
            if (mainImage && !mainImage.classList.contains('loaded')) {
                mainImage.src = mainImage.src;
            }
        });

        document.getElementById('mainMemoryImage')?.addEventListener('click', function() {
            if (this.classList.contains('loaded')) {
                openModal(this.src);
            }
        });

        // Step Navigation
        let currentStep = 1;
        const totalSteps = 5;

        function updateProgressBar() {
            const progress = ((currentStep - 1) / (totalSteps - 1)) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function showStep(stepNumber) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });

            document.getElementById(`step${stepNumber}`).classList.add('active');
            updateProgressBar();

            if (stepNumber === totalSteps) {
                document.getElementById('confetti-btn').classList.add('animate-pulse');
            }

            if (window.innerWidth <= 768) {
                document.getElementById(`step${stepNumber}`).scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // Button event listeners
        document.getElementById('start-btn').addEventListener('click', () => {
            currentStep = 2;
            showStep(currentStep);
        });

        document.getElementById('next-btn-2').addEventListener('click', () => {
            currentStep = 3;
            showStep(currentStep);
        });

        document.getElementById('next-btn-3').addEventListener('click', () => {
            currentStep = 4;
            showStep(currentStep);
        });

        document.getElementById('next-btn-4').addEventListener('click', () => {
            currentStep = 5;
            showStep(currentStep);
        });

        // Confetti button
        document.getElementById('confetti-btn').addEventListener('click', () => {
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#ff0000', '#ff69b4', '#ff1493', '#ffc0cb']
            });

            setTimeout(() => {
                confetti({
                    particleCount: 30,
                    spread: 60,
                    origin: { y: 0.5 },
                    shapes: ['heart'],
                    colors: ['#ff0000', '#ff69b4']
                });
            }, 300);

            setTimeout(() => {
                confetti({
                    particleCount: 20,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 },
                    shapes: ['heart'],
                    colors: ['#ff0000', '#ff69b4']
                });

                confetti({
                    particleCount: 20,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 },
                    shapes: ['heart'],
                    colors: ['#ff0000', '#ff69b4']
                });
            }, 600);

            hearts.forEach(heart => {
                gsap.to(heart.position, {
                    y: heart.position.y - 30,
                    duration: 3,
                    ease: "power1.out"
                });

                gsap.to(heart.material, {
                    opacity: 0,
                    duration: 3,
                    ease: "power1.out"
                });
            });
        });

        // Music player
        const music = document.getElementById('birthdayMusic');
        const musicToggle = document.getElementById('musicToggle');
        const musicIcon = musicToggle.querySelector('i');
        let isMusicPlaying = false;

        function playMusic() {
            if (music.paused) {
                music.play()
                    .then(() => {
                        isMusicPlaying = true;
                        musicIcon.className = 'fas fa-volume-up';
                        musicToggle.style.background = 'rgba(236, 72, 153, 0.2)';
                    })
                    .catch(error => {
                        console.log("Autoplay prevented.");
                    });
            }
        }

        function toggleMusic() {
            if (isMusicPlaying) {
                music.pause();
                musicIcon.className = 'fas fa-music';
                musicToggle.style.background = 'rgba(255, 255, 255, 0.9)';
            } else {
                music.play();
                musicIcon.className = 'fas fa-volume-up';
                musicToggle.style.background = 'rgba(236, 72, 153, 0.2)';
            }
            isMusicPlaying = !isMusicPlaying;
        }

        function initMusic() {
            document.addEventListener('click', function initMusicOnce() {
                playMusic();
                document.removeEventListener('click', initMusicOnce);
            }, { once: true });

            setTimeout(playMusic, 1000);
        }

        musicToggle.addEventListener('click', toggleMusic);
        initMusic();

        updateProgressBar();

        document.addEventListener('touchmove', function(e) {}, { passive: true });

        window.addEventListener('load', function() {
            const mainImage = document.getElementById('mainMemoryImage');
            if (mainImage) {
                const img = new Image();
                img.src = mainImage.src;
                img.onload = function() {
                    mainImage.classList.add('loaded');
                    document.getElementById('imagePlaceholder').style.display = 'none';
                };
                img.onerror = function() {
                    console.error('Main image failed to load on page load');
                };
            }
        });
    </script>
</body>
</html>




